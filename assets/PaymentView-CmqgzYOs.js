import{a as x,bb as _,i as y,bM as f,H as h,bi as l,b7 as i,be as w,e as b,j as e,t as v,k as S,m as C,b5 as k,p as B,o as E,z as q}from"./index-efaOxweq.js";import{a as P,u as m}from"./order-XcvcrzSN.js";import{E as M}from"./index-seytzcrd.js";import"./index-BA4IKA9J.js";import"./event-BB_Ol6Sd.js";import"./index-nryOYyGd.js";const U="/creative-oasis/assets/wechat-pay-Bh5FpESi.jpg",R={class:"h-[calc(100vh-65px)] bg-gray-50 dark:bg-gray-900 py-8"},I={class:"max-w-md mx-auto px-4"},V={class:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6"},j={class:"flex flex-col items-center mb-6"},N={class:"mt-4 text-center"},T={class:"text-lg font-medium text-gray-900 dark:text-white"},z={class:"flex justify-center mt-6"},A=x({__name:"PaymentView",setup(F){const o=f(),s=w(),u=_(),d=y({order_no:"",amount:0,status:"pending",signature:"",order_type:"monthly",qr_code:"",created_at:"",updated_at:"",paid_time:null,expire_time:""}),p=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),c=o.query.from==="qrcode",g=async()=>{try{await M.confirm("确认已完成支付？","支付确认",{confirmButtonText:"已完成支付",cancelButtonText:"取消",type:"info"}),(await m({order_no:o.query.order_no,status:"paid",signature:o.query.signature})).code===l.SUCCESS&&(u.fetchUserInfo(),s.push({name:"payment-result",query:{out_trade_no:d.value.order_no}}))}catch(r){console.error("确认支付失败:",r)}};return h(async()=>{const r=await P({order_no:o.query.order_no});if(r.code===l.SUCCESS&&(d.value=r.data),p&&!c){i.warning("请在PC端访问支付页面"),s.push({name:"home"});return}if(c){if(!u.isLoggedIn){const n=encodeURIComponent(window.location.href);s.push({name:"login",query:{redirect:n}});return}const{order_no:t,signature:a}=o.query;if(!t||!a){i.error("支付参数不完整"),s.push({name:"home"});return}try{(await m({order_no:t,status:"scanned",signature:a})).code===l.SUCCESS||(i.error("二维码已失效"),s.push({name:"home"}))}catch(n){console.error("更新订单状态失败:",n),i.error("操作失败，请稍后重试"),s.push({name:"home"})}}}),(r,t)=>{const a=k;return E(),b("div",R,[e("div",I,[e("div",V,[t[3]||(t[3]=e("div",{class:"text-center mb-6"},[e("h2",{class:"text-xl font-bold text-gray-900 dark:text-white"},"扫码成功"),e("p",{class:"mt-2 text-sm text-gray-500 dark:text-gray-400"},"请在PC端确认支付")],-1)),e("div",j,[t[1]||(t[1]=e("div",{class:"bg-white p-4 rounded-lg shadow-md w-[280px]"},[e("div",{class:"relative aspect-[0.74] w-full bg-gray-50 rounded-lg overflow-hidden"},[e("img",{src:U,alt:"微信付款码",class:"absolute inset-0 w-full h-full object-cover hover:scale-105 transition-transform duration-300"})])],-1)),e("div",N,[e("p",T," ¥"+v(d.value.amount||"9999.00"),1),t[0]||(t[0]=e("p",{class:"mt-2 text-sm text-gray-500 dark:text-gray-400"}," 请使用微信扫描上方二维码完成支付 ",-1))])]),e("div",z,[S(a,{type:"primary",size:"large",class:"w-full sm:w-auto min-w-[200px]",onClick:g},{default:C(()=>t[2]||(t[2]=[B(" 确认已完成支付 ")])),_:1})]),t[4]||(t[4]=e("div",{class:"mt-6"},[e("h3",{class:"text-sm font-medium text-gray-900 dark:text-white mb-2"},"温馨提示："),e("ul",{class:"text-xs text-gray-500 dark:text-gray-400 space-y-1.5"},[e("li",null,"1. 支付完成后，系统将在30分钟内完成会员开通"),e("li",null,"2. 会员服务属于虚拟商品，支付成功后不支持退款"),e("li",null,"3. 微信支付时请确保备注邮箱与登录账号一致，以便及时到账")])],-1))])])])}}}),J=q(A,[["__scopeId","data-v-cd215227"]]);export{J as default};
