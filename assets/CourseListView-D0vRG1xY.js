import{_ as xe,a as he,b as ye,c as be,t as ke,p as we,r as Ce}from"./MembershipDialog-DqAIk0Cb.js";import{a as Ie,bb as Le,i as p,c as Ve,H as Ee,ae as $e,I as ze,e as c,j as e,k as r,h as Se,n as x,L as V,M as P,m as v,E as je,t as i,g as d,b5 as De,bM as Re,b7 as g,c0 as Te,A as S,F as B,aC as Ae,bd as Me,p as h,f as E,c1 as ae,c2 as le,aY as oe,bG as Pe,be as Be,o,z as Ne}from"./index-efaOxweq.js";/* empty css                */import{E as Ue}from"./avatar-CXBjiNfm.js";/* empty css            */import{E as Fe}from"./index-BA4IKA9J.js";import{E as We}from"./index-Dli4OaBh.js";import"./order-XcvcrzSN.js";import"./index-ClkCYxdB.js";import"./index-nryOYyGd.js";import"./event-BB_Ol6Sd.js";const Ge={class:"min-h-[calc(100vh-65px)] bg-gray-100 dark:bg-gray-900"},He={class:"max-w-[1400px] mx-auto px-4 lg:px-6 py-6"},Ye={class:"flex gap-6 relative"},qe={class:"h-full flex flex-col"},Je={class:"flex-1 overflow-y-auto"},Ke=["onClick"],Oe={class:"flex gap-2"},Qe={class:"relative w-20 h-14 rounded overflow-hidden flex-shrink-0"},Xe=["src","alt"],Ze={key:0,class:"absolute inset-0 bg-black/50 flex items-center justify-center"},et={key:1,class:"absolute inset-0 bg-black/30 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center"},tt={class:"flex-1 min-w-0"},st={class:"flex items-center text-[11px] text-gray-500 dark:text-gray-400 mt-1"},at={class:"bg-white dark:bg-gray-800 rounded-lg shadow-sm overflow-hidden"},lt={class:"relative bg-black"},ot={class:"aspect-video"},rt=["src"],it={key:1,class:"absolute inset-0 flex items-center justify-center bg-gray-900"},nt={class:"p-6"},dt={class:"text-xl font-bold text-gray-900 dark:text-white mb-4"},ct={class:"flex flex-wrap gap-2 mb-4"},ut={class:"text-gray-600 dark:text-gray-400"},_t={class:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6"},vt={class:"mt-8"},pt={class:"flex items-center justify-between mb-4"},gt={class:"flex items-center gap-2"},ft={class:"text-gray-500 text-sm"},mt={class:"flex items-center gap-4"},xt={class:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4 mb-6"},ht={class:"flex gap-3"},yt={class:"flex-1"},bt={class:"flex justify-between items-center mt-2"},kt={class:"text-xs text-gray-400"},wt={class:"space-y-6"},Ct={class:"flex gap-3"},It={class:"flex-1"},Lt={class:"flex items-center gap-2"},Vt={class:"font-medium text-primary-500"},Et={class:"text-xs text-gray-400"},$t={class:"mt-2 text-gray-800 dark:text-gray-200 break-all"},zt={class:"mt-2 flex items-center gap-4 text-sm"},St=["onClick"],jt=["onClick"],Dt={key:0,class:"mt-3 pl-4 border-l-2 border-gray-100 dark:border-gray-700"},Rt={class:"flex gap-3"},Tt={class:"flex-1"},At={class:"flex items-center gap-2"},Mt={class:"font-medium text-primary-500"},Pt={class:"font-medium text-primary-500"},Bt={class:"text-xs text-gray-400"},Nt={class:"mt-1 text-gray-800 dark:text-gray-200 break-all"},Ut={class:"mt-2 flex items-center gap-4 text-sm"},Ft=["onClick"],Wt=["onClick"],Gt={key:0,class:"mt-2 text-sm"},Ht=["onClick"],Yt={key:1,class:"mt-3"},qt={class:"flex gap-3"},Jt={class:"flex-1"},Kt={class:"flex justify-end gap-2 mt-2"},Ot=Ie({__name:"CourseListView",setup(Qt){const F=Re();Be();const n=Le(),w=p(window.innerWidth<768),j=p([]),u=p(null),W=p(!0),D=p(!1),f=p(null),C=p(""),y=p(""),b=p(null),R=p({}),N=p(!1),$=p("hot"),re=Ve(()=>$.value==="hot"?[...T.value].sort((a,t)=>t.likes-a.likes):[...T.value].sort((a,t)=>new Date(t.created_at).getTime()-new Date(a.created_at).getTime())),T=p([]),G=p(!1),I=()=>{f.value&&(G.value=!f.value.paused)},ie=async()=>{try{W.value=!0;const a=Number(F.params.id),t=await he({category:a});console.log(t),j.value=t.data,j.value.length>0&&!u.value&&await H(j.value[0].id)}catch(a){g.error("获取视频列表失败"),console.log("error",a)}finally{W.value=!1}},H=async a=>{try{const t=Number(F.params.id),_=await ye({category:t,id:a});u.value=_.data}catch(t){console.error("获取视频详情失败:",t)}},ne=async a=>{var t;if(!a.is_free&&(!n.isLoggedIn||!((t=n.userInfo)!=null&&t.is_member))){D.value=!0;return}await H(a.id)},de=a=>{const t=Math.floor(a/60),_=a%60;return`${t}:${_.toString().padStart(2,"0")}`},ce=a=>{var t;return!a.is_free&&(!n.isLoggedIn||!((t=n.userInfo)!=null&&t.is_member))},ue=()=>{f.value&&(f.value.currentTime=0,f.value.addEventListener("play",I),f.value.addEventListener("pause",I))},A=async()=>{var a;if((a=u.value)!=null&&a.id)try{const t=await be({video_id:u.value.id});console.log("获取评论列表",t),t.code===200&&(T.value=t.data)}catch(t){console.error("获取评论失败:",t)}},_e=async()=>{if(!n.isLoggedIn){g.warning("请先登录后再评论");return}if(!C.value.trim()){g.warning("评论内容不能为空");return}N.value=!0;try{(await we({video_id:u.value.id,content:C.value.trim()})).code===200&&(g.success("评论成功"),C.value="",await A())}catch{g.error("评论失败，请稍后重试")}finally{N.value=!1}},ve=a=>{R.value[a]=!R.value[a]},Y=(a,t)=>{var _;if(!n.isLoggedIn){g.warning("请先登录后再回复");return}if(t&&t.id===((_=n.userInfo)==null?void 0:_.id)){g.warning("不能回复自己的评论");return}b.value={commentId:a.id,replyTo:t},y.value=""},q=()=>{b.value=null,y.value=""},pe=async a=>{var t,_,k;if(!n.isLoggedIn){g.warning("请先登录后再回复");return}if(!y.value.trim()){g.warning("回复内容不能为空");return}if(a.user.id===((t=n.userInfo)==null?void 0:t.id)&&!((_=b.value)!=null&&_.replyTo)){g.warning("不能回复自己的评论");return}try{await Ce({video_id:u.value.id,comment_id:a.id,content:y.value.trim(),reply_to:(k=b.value)==null?void 0:k.replyTo}),await A(),q(),g.success("回复成功")}catch{g.error("回复失败，请稍后重试")}},J=async a=>{if(!n.isLoggedIn){g.warning("请先登录后再点赞");return}try{const t=await ke({video_id:u.value.id,comment_id:a.id});a.is_liked=t.data.is_liked,a.likes=t.data.likes}catch{g.error("操作失败，请稍后重试")}};return Ee(()=>{var a;ie(),window.addEventListener("resize",()=>{window.innerWidth<768&&(w.value=!0)}),(a=u.value)!=null&&a.id&&A()}),$e(()=>{var a;return(a=u.value)==null?void 0:a.id},a=>{a&&A()}),ze(()=>{f.value&&(f.value.removeEventListener("play",I),f.value.removeEventListener("pause",I))}),(a,t)=>{var Q,X,Z,ee;const _=je,k=De,K=Ae,ge=We,M=Ue,O=Fe,fe=xe;return o(),c(V,null,[e("div",Ge,[e("div",He,[e("div",Ye,[e("div",{class:x(["w-52 lg:w-60 flex-shrink-0 bg-white dark:bg-gray-800 rounded-lg shadow-sm overflow-hidden fixed z-10",["transition-all duration-300"]]),style:Se({left:w.value?"-240px":"max(calc((100vw - 1400px) / 2 + 24px), 24px)",top:"65px",bottom:0})},[e("div",qe,[t[7]||(t[7]=e("div",{class:"p-3 border-b border-gray-200 dark:border-gray-700"},[e("h2",{class:"text-base font-semibold text-gray-900 dark:text-white"},"课程目录")],-1)),e("div",Je,[(o(!0),c(V,null,P(j.value,s=>{var m,z;return o(),c("div",{key:s.id,class:x(["group p-2.5 hover:bg-gray-50 dark:hover:bg-gray-700/50 cursor-pointer",{"bg-primary-50 dark:bg-primary-900/50":s.id===((m=u.value)==null?void 0:m.id)}]),onClick:L=>ne(s)},[e("div",Oe,[e("div",Qe,[e("img",{src:s.cover_url,alt:s.title,class:"w-full h-full object-cover"},null,8,Xe),ce(s)?(o(),c("div",Ze,[r(_,{class:"text-white text-xl"},{default:v(()=>[r(d(Te))]),_:1})])):(o(),c("div",et,[r(K,{content:s.title,placement:"top","show-after":200,"hide-after":0,effect:"dark"},{default:v(()=>[r(k,{type:"primary",circle:"",class:"!w-8 !h-8 !text-lg transform hover:scale-110 transition-transform"},{default:v(()=>[r(_,null,{default:v(()=>{var L;return[(o(),S(B(s.id===((L=u.value)==null?void 0:L.id)&&G.value?"VideoPause":"VideoPlay")))]}),_:2},1024)]),_:2},1024)]),_:2},1032,["content"])]))]),e("div",tt,[e("h3",{class:x(["text-xs font-medium text-gray-900 dark:text-white line-clamp-2",{"text-primary-600 dark:text-primary-400":s.id===((z=u.value)==null?void 0:z.id)}])},i(s.title),3),e("div",st,[e("span",null,i(de(s.duration)),1)])])])],10,Ke)}),128))])])],4),e("div",{class:x(["flex-1 flex flex-col gap-6 transition-all duration-300",[w.value?"ml-0":"ml-[224px] lg:ml-[256px]"]])},[e("div",at,[e("div",lt,[e("div",ot,[u.value?(o(),c("video",{key:0,ref_key:"videoPlayer",ref:f,src:u.value.video_url,class:"w-full h-full hover:cursor-pointer",controls:"",autoplay:"",preload:"metadata",onLoadedmetadata:ue,onPlay:I,onPause:I},null,40,rt)):(o(),c("div",it,[r(_,{class:"text-4xl text-gray-600"},{default:v(()=>[r(d(Me))]),_:1})]))])]),e("div",nt,[e("h1",dt,i((Q=u.value)==null?void 0:Q.title),1),e("div",ct,[(o(!0),c(V,null,P((X=u.value)==null?void 0:X.tech_stack,s=>(o(),S(ge,{key:s.id,size:"small",class:"bg-primary-50 text-primary-600 border-primary-200"},{default:v(()=>[h(i(s.name),1)]),_:2},1024))),128))]),e("p",ut,i((Z=u.value)==null?void 0:Z.description),1)])]),e("div",_t,[t[12]||(t[12]=e("h2",{class:"text-lg font-bold text-gray-900 dark:text-white mb-6"},"评论区",-1)),e("div",vt,[e("div",pt,[e("div",gt,[t[8]||(t[8]=e("h3",{class:"text-lg font-bold"},"评论",-1)),e("span",ft,i(T.value.length),1)]),e("div",mt,[e("button",{class:x(["text-sm hover:text-primary-500 transition-colors",[$.value==="hot"?"text-primary-500":"text-gray-500"]]),onClick:t[0]||(t[0]=s=>$.value="hot")}," 最热 ",2),e("button",{class:x(["text-sm hover:text-primary-500 transition-colors",[$.value==="new"?"text-primary-500":"text-gray-500"]]),onClick:t[1]||(t[1]=s=>$.value="new")}," 最新 ",2)])]),e("div",xt,[e("div",ht,[r(M,{size:36,src:(ee=d(n).userInfo)==null?void 0:ee.avatar,class:"flex-shrink-0"},{default:v(()=>{var s,m;return[h(i((m=(s=d(n).userInfo)==null?void 0:s.nickname)==null?void 0:m.charAt(0)),1)]}),_:1},8,["src"]),e("div",yt,[r(O,{modelValue:C.value,"onUpdate:modelValue":t[2]||(t[2]=s=>C.value=s),type:"textarea",rows:5,placeholder:d(n).isLoggedIn?"发一条友善的评论":"登录后发表评论",disabled:!d(n).isLoggedIn,class:"comment-input"},null,8,["modelValue","placeholder","disabled"]),e("div",bt,[e("div",kt,i(d(n).isLoggedIn?"善语结善缘，恶言伤人心":"请先登录后再发表评论"),1),r(k,{type:"primary",disabled:!d(n).isLoggedIn||!C.value.trim(),loading:N.value,class:"!h-9",onClick:_e},{default:v(()=>t[9]||(t[9]=[h(" 发布 ")])),_:1},8,["disabled","loading"])])])])]),e("div",wt,[(o(!0),c(V,null,P(re.value,s=>{var m,z,L,te;return o(),c("div",{key:s.id,class:"group"},[e("div",Ct,[r(M,{size:36,src:s.user.avatar,class:"flex-shrink-0"},{default:v(()=>[h(i(s.user.name.charAt(0)),1)]),_:2},1032,["src"]),e("div",It,[e("div",Lt,[e("span",Vt,i(s.user.name),1),e("span",Et,i(s.created_at),1)]),e("p",$t,i(s.content),1),e("div",zt,[e("button",{class:x(["flex items-center gap-1 transition-colors",[s.is_liked?"text-primary-500":"text-gray-400 hover:text-primary-500"]]),onClick:l=>J(s)},[r(_,null,{default:v(()=>[(o(),S(B(s.is_liked?d(ae):d(le))))]),_:2},1024),e("span",null,i(s.likes||"点赞"),1)],10,St),s.user.id!==((m=d(n).userInfo)==null?void 0:m.id)?(o(),c("button",{key:0,class:"text-gray-400 hover:text-primary-500 transition-colors",onClick:l=>Y(s)}," 回复 ",8,jt)):E("",!0)]),(z=s.replies)!=null&&z.length?(o(),c("div",Dt,[(o(!0),c(V,null,P(R.value[s.id]?s.replies:s.replies.slice(0,2),(l,U)=>{var se;return o(),c("div",{key:l.id,class:"mb-3 last:mb-0"},[e("div",Rt,[r(M,{size:32,src:l.user.avatar,class:"flex-shrink-0"},{default:v(()=>[h(i(l.user.name.charAt(0)),1)]),_:2},1032,["src"]),e("div",Tt,[e("div",At,[e("span",Mt,i(l.user.name),1),l.reply_to?(o(),c(V,{key:0},[r(_,{class:"text-gray-400"},{default:v(()=>[r(d(oe))]),_:1}),e("span",Pt,i(l.reply_to.name),1)],64)):E("",!0),e("span",Bt,i(l.created_at),1)]),e("p",Nt,i(l.content),1),e("div",Ut,[e("button",{class:x(["flex items-center gap-1 transition-colors",[l.is_liked?"text-primary-500":"text-gray-400 hover:text-primary-500"]]),onClick:me=>J(l)},[r(_,null,{default:v(()=>[(o(),S(B(l.is_liked?d(ae):d(le))))]),_:2},1024),e("span",null,i(l.likes||"点赞"),1)],10,Ft),l.user.id!==((se=d(n).userInfo)==null?void 0:se.id)?(o(),c("button",{key:0,class:"text-gray-400 hover:text-primary-500 transition-colors",onClick:me=>Y(s,l.user)}," 回复 ",8,Wt)):E("",!0)])])])])}),128)),s.replies.length>2?(o(),c("div",Gt,[e("button",{class:"text-primary-500 hover:text-primary-600 transition-colors",onClick:l=>ve(s.id)},i(R.value[s.id]?"收起回复":`展开 ${s.replies.length-2} 条回复`),9,Ht)])):E("",!0)])):E("",!0),((L=b.value)==null?void 0:L.commentId)===s.id?(o(),c("div",Yt,[e("div",qt,[r(M,{size:32,src:(te=d(n).userInfo)==null?void 0:te.avatar,class:"flex-shrink-0"},{default:v(()=>{var l,U;return[h(i((U=(l=d(n).userInfo)==null?void 0:l.nickname)==null?void 0:U.charAt(0)),1)]}),_:1},8,["src"]),e("div",Jt,[r(O,{modelValue:y.value,"onUpdate:modelValue":t[3]||(t[3]=l=>y.value=l),type:"textarea",rows:2,placeholder:b.value.replyTo?`回复 @${b.value.replyTo.name}`:"善语结善缘，恶言伤人心",class:"reply-input"},null,8,["modelValue","placeholder"]),e("div",Kt,[r(k,{onClick:q},{default:v(()=>t[10]||(t[10]=[h("取消")])),_:1}),r(k,{type:"primary",disabled:!y.value.trim(),onClick:l=>pe(s)},{default:v(()=>t[11]||(t[11]=[h(" 回复 ")])),_:2},1032,["disabled","onClick"])])])])])):E("",!0)])])])}),128))])])])],2)])]),e("button",{class:"fixed left-4 top-20 z-50 p-2 bg-white dark:bg-gray-800 rounded-full shadow-lg hover:shadow-xl transition-all",onClick:t[4]||(t[4]=s=>w.value=!w.value)},[r(_,{class:"text-xl"},{default:v(()=>[(o(),S(B(w.value?d(oe):d(Pe))))]),_:1})])]),r(fe,{visible:D.value,"onUpdate:visible":t[5]||(t[5]=s=>D.value=s),onClose:t[6]||(t[6]=s=>D.value=!1)},null,8,["visible"])],64)}}}),ds=Ne(Ot,[["__scopeId","data-v-b21bcf21"]]);export{ds as default};
